{% extends "base.html" %}

{% block head %}

<script>
    var AllPatterns = [];
    const SelectedButtons = [];

    function ButtonClick(buttonid) {
        SelectedButtons[buttonid] = 1 - SelectedButtons[buttonid];
        if (SelectedButtons[buttonid]){ 
            document.getElementById(buttonid).classList.add("btn-success");
            document.getElementById(buttonid).classList.remove("btn-outline-success");
        }
        else {
            document.getElementById(buttonid).classList.add("btn-outline-success");
            document.getElementById(buttonid).classList.remove("btn-success");
        }
    }

    function OnSubmit() {
        if (AllPatterns.length === 0)
            return;

        var url = "/train?size=" + {{ size }} + "&" + "array=";
        for (const x of AllPatterns) 
            url += x;
        window.location.href = url;

        document.getElementById("inner-container").innerHTML =
                `<div class="d-flex justify-content-center">
                    <div class="card col col-6">
                        <img src="https://c.tenor.com/I6kN-6X7nhAAAAAj/loading-buffering.gif" class="card-img-top p-3" alt="loading"/>
                        <div class="card-body">
                            <h5 class="card-title">Training...</h5>
                            <h6 class="card-subtitle mb-2 text-muted">Practice makes perfect!</h6>
                            <p class="card-text">
                                A neural network is being trained to play your newly created game using the AlphaZero algorithm.
                            </p>
                            <p class="card-text text-muted">
                                This may take a few minutes...
                            </p>
                        </div>
                    </div>
                </div>
                `;
    }

    function OnAdd() {
        AllPatterns = AllPatterns.concat(SelectedButtons);

        for (i = 0; i < {{ size * size }}; i++)
            if (SelectedButtons[i])
                ButtonClick(i);
    }

</script>

<style>
    .grid-btn {
        width: {{ 300 // size }}px;
        height: {{ 300 // size }}px;
    }
</style>

{% endblock %}


{% block content %}

<h1 class="text-center display-4">Shaping Your Game</h1>

<div id="inner-container" class="row">
    <div class="card col col-5">
        <img src="{{ url_for('static', filename='tic-tac-toe.png') }}" class="card-img-top p-3" alt="loading"/>
        <div class="card-body">
            <h5 class="card-title">Winning Shapes</h5>
            <h6 class="card-subtitle mb-2 text-muted">Be creative!</h6>
            <p class="card-text">
                Simple shapes tend to result in quick games with one player
                winning. Complex shapes may give you an advantage but also make
                draws more frequent.
            </p>

            <p class="card-text">
                Click on the grid cells to create as many shapes as you like!
            </p>
        </div>
    </div>
    <div class="col col-7">
        <div class="d-flex justify-content-center mb-3 mt-5">
            <table>
                <tbody>
                    {% for i in range(size) %}
                        <tr>
                            {% for j in range(size) %}
                                <td>
                                    <button
                                        class="btn btn-outline-success grid-btn align-middle fs-2"
                                        name="choice"
                                        id="{{ i * size + j }}"
                                        onclick="ButtonClick(this.id)"
                                    >
                                    </button>
                                </td>
                            {% endfor %}
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <div class="d-flex justify-content-center">
            <button class="btn btn-primary col-4 m-3" onclick="OnAdd()">Add shape</button>
            <button class="btn btn-primary col-4 m-3" onclick="OnSubmit()">Done!</button>
        </div>
    </div>
</div>

<script>
    for(i = 0; i < {{ size * size }}; i++)
        SelectedButtons[i] = 0;
</script>

{% endblock %}
